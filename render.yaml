services:
  - type: web
    name: molecular-docking-app
    runtime: node
    plan: free
    region: oregon
    buildCommand: |
      echo "ðŸ“¦ Installing dependencies..."
      npm install
      echo "ðŸ“ Creating directories..."
      mkdir -p tools
      mkdir -p output
      echo "ðŸ“¥ Downloading AutoDock Vina..."
      cd tools
      if [ ! -f "vina_1.2.5_linux_x86_64" ]; then
        wget https://github.com/ccsb-scripps/AutoDock-Vina/releases/download/v1.2.5/vina_1.2.5_linux_x86_64
        chmod +x vina_1.2.5_linux_x86_64
        echo "âœ… Vina downloaded successfully"
      else
        echo "âœ… Vina already exists"
      fi
      echo "ðŸ”‘ Setting execute permissions..."
      chmod +x vina_1.2.5_linux_x86_64
      ls -la
      cd ..
      echo "ðŸ“ Checking config.txt..."
      if [ ! -f "config.txt" ]; then
        echo "âš ï¸  config.txt not found, creating default..."
        cat > config.txt << 'EOF'
      receptor = receptor.pdbqt
      ligand = ligand.pdbqt
      center_x = 0
      center_y = 0
      center_z = 0
      size_x = 20
      size_y = 20
      size_z = 20
      exhaustiveness = 8
      out = output/output_docked.pdbqt
      log = output/log.txt
      EOF
      else
        echo "âœ… config.txt found"
      fi
      echo "ðŸ“‹ Listing files..."
      ls -la
      echo "âœ… Build complete!"
    startCommand: node server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
    healthCheckPath: /health
    autoDeploy: true